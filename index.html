<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anus Words v. Subs</title>
<style>
body {
  font-family: "MS Sans Serif", Tahoma, sans-serif;
  background: #008080;
  color: black;
  margin: 0;
  padding-bottom: 40px;
  text-align: center;
  overflow-x: hidden;
}

/* Start bar */
#startBar {
  position: fixed; bottom: 0; left: 0; width: 100%; height: 40px;
  background: #c0c0c0; border-top: 2px solid #fff inset; border-bottom: 2px solid #000 outset;
  display: flex; align-items: center; justify-content: space-between; padding: 0 5px;
}
#startBar button { font-family: "MS Sans Serif"; font-weight: bold; padding: 4px 10px; border: 2px outset #fff; background: #c0c0c0; cursor: pointer; }
#clock { font-size: 12px; font-weight: bold; }

/* Draggable dialog windows */
.window, #subscriberBox, #timerBox {
  border: 2px solid #000; box-shadow: 4px 4px #808080; background: #c0c0c0; position: absolute;
  font-family: "MS Sans Serif";
  touch-action: none;
  min-width: 150px;
}
.window { width: 600px; max-width: 90%; top: 60px; left: 50%; transform: translateX(-50%); }
.title-bar {
  background: #000080; color: white; padding: 3px 5px; font-weight: bold; font-size: 14px;
  display: flex; justify-content: space-between; align-items: center;
  cursor: move;
}
.title-bar button {
  width: 20px; height: 18px; font-weight: bold; font-family: "MS Sans Serif";
  border: 2px outset #fff; background: #c0c0c0; cursor: pointer;
}
.content { padding: 10px; background: #c0c0c0; font-family: "MS Sans Serif"; }
input#wordInput { padding: 4px; font-size: 14px; width: 100%; max-width: 580px; border: 2px inset #fff; box-sizing: border-box; }
#counter { margin: 10px 0; font-weight: bold; font-size: 16px; }
#message { color: red; font-weight: bold; margin-top: 5px; }
#wordList { max-height: 250px; overflow-y: auto; background: #fff; border: 2px inset #fff; margin-top: 10px; padding: 5px; list-style: none; font-family: "MS Sans Serif"; }
li { border-bottom: 1px solid #808080; padding: 2px; font-family: "MS Sans Serif"; }

/* Progress bar */
.progress-container { background: #c0c0c0; border: 2px solid #fff inset; width: 600px; max-width: 90%; height: 20px; margin: 10px auto 40px; padding: 2px; display: flex; align-items: center; position: relative; font-family: "MS Sans Serif";}
.progress-bar { background: #000080; height: 100%; display: flex; align-items: center; font-size: 12px; font-weight: bold; color: black; overflow: hidden; position: relative; }
.pixel { width: 4px; height: 100%; background: #000080; margin-right: 1px; }

/* Subscriber tracker */
#subscriberBox { width: 200px; z-index:10; top: 10px; right: 10px; }
#subscriberBox .content { display: flex; align-items: center; gap: 5px; justify-content: center; font-size: 14px; padding: 5px; font-family: "MS Sans Serif"; }

/* Timer window */
#timerBox { width: 200px; z-index: 10; top: 10px; left: 10px; }
#timerBox .content { padding:5px; display:flex; flex-direction:column; gap:5px; align-items:center; font-size:14px; font-family: "MS Sans Serif"; }
#timerBox .buttons-row { display:flex; gap:5px; justify-content:center; }

/* Minimized boxes container */
#minimizedContainer { position: fixed; bottom: 40px; left: 0; display: flex; gap: 5px; padding: 5px; }
.minimized-btn { font-family: "MS Sans Serif"; border: 2px outset #fff; background: #c0c0c0; cursor: pointer; padding: 2px 6px; font-size:12px; }

@media(max-width:700px){
  .window,#subscriberBox,#timerBox{width:90%; left:5% !important; transform:none;}
}
</style>
</head>
<body>

<!-- Minimized container -->
<div id="minimizedContainer"></div>

<!-- Subscriber tracker -->
<div id="subscriberBox">
  <div class="title-bar">
    <span>Subscribers</span>
    <div>
      <button class="minimizeBtn">_</button>
      <button onclick="window.open('https://www.youtube.com/@ANewUntoldStory','_blank')">X</button>
    </div>
  </div>
  <div class="content">
    <span id="subscriberCount">Loading...</span>
  </div>
</div>

<!-- Timer -->
<div id="timerBox">
  <div class="title-bar">
    <span>Timer</span>
    <div>
      <button class="minimizeBtn">_</button>
      <button onclick="timerBox.style.display='none'">X</button>
    </div>
  </div>
  <div class="content">
    <div>Time: <span id="elapsed">0.00</span> s</div>
    <div>WPM: <span id="wpm">0</span></div>
    <div>ETA: <span id="eta">0d 0h 0m</span></div>
    <div class="buttons-row">
      <button id="startBtn">Start</button>
      <button id="pauseBtn">Pause</button>
      <button id="resetBtn">Reset</button>
    </div>
  </div>
</div>

<!-- Main words window -->
<div class="window">
  <div class="title-bar">
    <span>Anus Words v. Subs</span>
    <div>
      <button class="minimizeBtn">_</button>
      <button id="clearWordsBtn">X</button>
    </div>
  </div>
  <div class="content">
    <input id="wordInput" type="text" placeholder="Enter a word..." />
    <div id="counter">0 / 0</div>
    <div id="message"></div>
    <ul id="wordList"></ul>
  </div>
</div>

<div class="progress-container">
  <div id="progressBar" class="progress-bar"></div>
</div>

<!-- Start bar -->
<div id="startBar">
  <button id="bottomStartBtn">Start</button>
  <div id="clock"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection, writeBatch, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase setup
const firebaseConfig = {
  apiKey: "AIzaSyC8Z5Lx8W8RHYhsIGOb-yLVsv5Ufv50ULM",
  authDomain: "anus-words.firebaseapp.com",
  projectId: "anus-words",
  storageBucket: "anus-words.firebasestorage.app",
  messagingSenderId: "15328801675",
  appId: "1:15328801675:web:4b52ea27902c27fcfeb58e",
  measurementId: "G-MY6LCMKMX5"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const wordsCollection = collection(db,"words");

// DOM elements
const input=document.getElementById("wordInput"), list=document.getElementById("wordList"), counter=document.getElementById("counter"), message=document.getElementById("message");
const subscriberCountDiv=document.getElementById("subscriberCount"), progressBar=document.getElementById("progressBar");
const clearWordsBtn=document.getElementById("clearWordsBtn"), startBtn=document.getElementById("startBtn"), pauseBtn=document.getElementById("pauseBtn"), resetBtn=document.getElementById("resetBtn");
const bottomStartBtn=document.getElementById("bottomStartBtn"), elapsedSpan=document.getElementById("elapsed"), wpmSpan=document.getElementById("wpm"), etaSpan=document.getElementById("eta");
const timerBox=document.getElementById("timerBox"), minimizedContainer=document.getElementById("minimizedContainer");

let words=new Set(), subscriberCount=0, timer=null, elapsed=0, running=false;

// Clock
function updateClock(){ const now=new Date(); let h=now.getHours(); const ampm=h>=12?"PM":"AM"; h=h%12||12; const m=String(now.getMinutes()).padStart(2,'0'); const s=String(now.getSeconds()).padStart(2,'0'); document.getElementById("clock").textContent=`${h}:${m}:${s} ${ampm}`;}
setInterval(updateClock,1000); updateClock();

// Timer
function updateTimerDisplay(){ elapsedSpan.textContent=elapsed.toFixed(2); const wpm=elapsed>0? (words.size/(elapsed/60)):0; wpmSpan.textContent=wpm.toFixed(2); const etaSecs=wpm>0?(subscriberCount-words.size)/wpm*60:0; const d=Math.floor(etaSecs/86400), h=Math.floor((etaSecs%86400)/3600), m=Math.floor((etaSecs%3600)/60); etaSpan.textContent=`${d}d ${h}h ${m}m`; }
startBtn.onclick=function(){ if(!running){ running=true; timer=setInterval(()=>{elapsed+=0.1; updateTimerDisplay();},100); }}
pauseBtn.onclick=function(){ if(running){ clearInterval(timer); running=false; }}
resetBtn.onclick=function(){ clearInterval(timer); elapsed=0; running=false; updateTimerDisplay(); }

// Bottom Start button
bottomStartBtn.onclick=function(){ alert("Fuck No Baby!"); }

// Fetch words
async function fetchWords(){ words.clear(); const snapshot=await getDocs(wordsCollection); snapshot.forEach(docSnap=>words.add(docSnap.id.toLowerCase())); updateDisplay(); updateTimerDisplay(); }

// Add word
async function addWord(){ const newWord=input.value.trim().toLowerCase(); message.textContent=""; if(!newWord) return; if(words.has(newWord)){message.textContent="Duplicate!";} else { try{await setDoc(doc(db,"words",newWord),{createdAt:serverTimestamp()}); words.add(newWord); updateDisplay(); updateTimerDisplay();} catch(e){console.error(e); message.textContent="Error adding word.";} } input.value=""; input.focus(); }
input.addEventListener("keypress",function(e){if(e.key==="Enter") addWord();});

// Clear words
clearWordsBtn.addEventListener("click", async()=>{ const password=prompt("Password:"); if(password!=="anuspass"){alert("Incorrect password."); return;} const snapshot=await getDocs(wordsCollection); const batch=writeBatch(db); snapshot.forEach(docSnap=>batch.delete(docSnap.ref)); await batch.commit(); words.clear(); updateDisplay(); updateTimerDisplay(); alert("All words cleared!");});

// Update display & progress
function updateDisplay(){
  counter.textContent=`${words.size.toLocaleString()} / ${subscriberCount.toLocaleString()}`;
  list.innerHTML="";
  [...words].reverse().forEach(word=>{ const li=document.createElement("li"); li.textContent=word; list.appendChild(li); });
  const totalPixels=Math.floor(progressBar.clientWidth/5); let progress=subscriberCount>0? words.size/subscriberCount:0; if(progress>1) progress=1;
  progressBar.innerHTML="";
  const filledPixels=Math.floor(totalPixels*progress); for(let i=0;i<filledPixels;i++){ const pixel=document.createElement("div"); pixel.className="pixel"; progressBar.appendChild(pixel);}
  const textNode=document.createElement("span"); textNode.style.position="absolute"; textNode.style.left="50%"; textNode.style.transform="translateX(-50%)"; textNode.style.fontWeight="bold"; textNode.style.color="black"; textNode.textContent=(progress*100).toFixed(2)+"%"; progressBar.appendChild(textNode);
}

// Fetch subscribers
async function fetchSubscribers(){ const apiKey="AIzaSyBtcKxmge24wcaEQwJv0uBHKmQBLgIg0gw"; const channelId="UCL6OtB3m-gQ2mgRg61-aDXw"; try{ const res=await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${apiKey}`); const data=await res.json(); if(data.items&&data.items.length>0){ subscriberCount=parseInt(data.items[0].statistics.subscriberCount); subscriberCountDiv.textContent=subscriberCount.toLocaleString(); updateDisplay(); } else subscriberCountDiv.textContent="Subscriber data not found."; } catch(e){ subscriberCountDiv.textContent="Error loading subscribers."; console.error(e); }}
fetchWords(); fetchSubscribers(); setInterval(fetchSubscribers,30000);

// --- Draggable & Minimize ---
function makeDraggable(el){
  const title=el.querySelector('.title-bar');
  let offsetX=0, offsetY=0, isDown=false;
  title.addEventListener('mousedown', e=>{isDown=true; offsetX=e.clientX-el.offsetLeft; offsetY=e.clientY-el.offsetTop;});
  document.addEventListener('mousemove', e=>{if(!isDown) return; let x=e.clientX-offsetX, y=e.clientY-offsetY; x=Math.max(0,Math.min(window.innerWidth-el.offsetWidth,x)); y=Math.max(0,Math.min(window.innerHeight-el.offsetHeight,y)); el.style.left=x+'px'; el.style.top=y+'px';});
  document.addEventListener('mouseup', ()=>{isDown=false;});
}
document.querySelectorAll('.window, #subscriberBox, #timerBox').forEach(makeDraggable);

// Minimize buttons
document.querySelectorAll('.minimizeBtn').forEach(btn=>{
  btn.addEventListener('click', e=>{
    const win=btn.closest('.window, #subscriberBox, #timerBox');
    win.style.display='none';
    const minimized=document.createElement('button');
    minimized.className='minimized-btn';
    minimized.textContent=win.querySelector('.title-bar span').textContent;
    minimized.onclick=()=>{ win.style.display='block'; minimized.remove(); };
    minimizedContainer.appendChild(minimized);
  });
});

// --- Mobile repositioning ---
function repositionBoxes(){
  const boxes=[...document.querySelectorAll('.window, #subscriberBox, #timerBox')].filter(b=>b.style.display!=='none');
  let topOffset=10;
  boxes.forEach(b=>{
    if(window.innerWidth<700){
      b.style.top=topOffset+'px';
      b.style.left='5%';
      b.style.transform='none';
      topOffset+=b.offsetHeight+10;
    }
  });
}
window.addEventListener('resize', repositionBoxes);
repositionBoxes();
</script>
</body>
</html>
