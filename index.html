<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anus Words v. Subs</title>
<style>
/* Windows 95 styling */
body { font-family: "MS Sans Serif", Tahoma, Geneva, sans-serif; background: #008080; margin:0; padding-bottom:40px; text-align:center; color:black; }
.window { display:inline-block; width:600px; max-width:90%; margin:60px auto 20px; border:2px solid #000; box-shadow:4px 4px #808080; background:#c0c0c0; }
.title-bar { background:#000080; color:white; padding:3px 5px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; font-size:14px; }
.title-bar button { width:20px; height:18px; font-family:"MS Sans Serif"; border:2px outset #fff; background:#c0c0c0; cursor:pointer; }
.content { padding:10px; background:#c0c0c0; }
input#wordInput { width:100%; box-sizing:border-box; padding:4px; font-size:14px; border:2px inset #fff; margin-bottom:5px; }
#counter { margin:10px 0; font-weight:bold; font-size:16px; }
#message { color:red; font-weight:bold; margin-top:5px; }
#wordList { max-height:250px; overflow-y:auto; background:#fff; border:2px inset #fff; margin-top:10px; padding:5px; list-style:none; font-family:"MS Sans Serif"; }
li { border-bottom:1px solid #808080; padding:2px; }

/* Progress bar */
.progress-container { background:#c0c0c0; border:2px inset #fff; width:600px; max-width:90%; height:20px; margin:10px auto 40px; display:flex; align-items:center; position:relative; }
.progress-bar { background:#000080; height:100%; display:flex; align-items:center; font-size:12px; font-weight:bold; color:black; justify-content:center; }

/* Subscriber box */
#subscriberBox { position:fixed; top:10px; right:10px; width:200px; border:2px solid #000; box-shadow:4px 4px #808080; background:#c0c0c0; z-index:10; }
#subscriberBox .title-bar { background:#000080; color:white; padding:2px 5px; font-weight:bold; font-size:12px; display:flex; justify-content:space-between; align-items:center; }
#subscriberBox .title-bar button { width:18px; height:16px; font-weight:bold; font-family:"MS Sans Serif"; border:2px outset #fff; background:#c0c0c0; cursor:pointer; }
#subscriberBox .content { padding:5px; font-size:14px; display:flex; align-items:center; justify-content:center; }

/* Timer window */
#timerWindow { position:fixed; top:100px; right:10px; width:220px; border:2px solid #000; box-shadow:4px 4px #808080; background:#c0c0c0; z-index:10; }
#timerWindow .title-bar { background:#000080; color:white; padding:3px 5px; font-weight:bold; font-size:12px; display:flex; justify-content:space-between; align-items:center; }
#timerWindow .title-bar button { width:20px; height:18px; font-family:"MS Sans Serif"; border:2px outset #fff; background:#c0c0c0; cursor:pointer; }
#timerWindow .content { padding:10px; display:flex; flex-direction:column; gap:5px; align-items:center; }
#timerDisplay { font-family:"MS Sans Serif"; font-size:18px; font-weight:bold; }
#statsDisplay { font-size:12px; text-align:center; }
</style>
</head>
<body>

<!-- Subscriber tracker -->
<div id="subscriberBox">
  <div class="title-bar">
    <span>Subscribers</span>
    <button onclick="window.open('https://www.youtube.com/@ANewUntoldStory','_blank')">X</button>
  </div>
  <div class="content">
    <span id="subscriberCount">Loading...</span>
  </div>
</div>

<!-- Main word window -->
<div class="window">
  <div class="title-bar">
    <span>Anus Words v. Subs</span>
    <button id="clearWordsBtn">X</button>
  </div>
  <div class="content">
    <input id="wordInput" type="text" placeholder="Enter a word..." />
    <div id="counter">0 / 0</div>
    <div id="message"></div>
    <ul id="wordList"></ul>
  </div>
</div>

<div class="progress-container">
  <div id="progressBar" class="progress-bar">0%</div>
</div>

<!-- Timer -->
<div id="timerWindow">
  <div class="title-bar">
    <span>Timer</span>
    <button onclick="stopTimer()">X</button>
  </div>
  <div class="content">
    <div id="timerDisplay">00:00:00</div>
    <div id="statsDisplay">WPM: 0 | ETA: --:--:--</div>
    <div>
      <button onclick="startTimer()">Start</button>
      <button onclick="pauseTimer()">Pause</button>
      <button onclick="resetTimer()">Reset</button>
    </div>
  </div>
</div>

<script type="module">
// --------------------
// Firebase setup (add your config)
// --------------------
// import { initializeApp } from "firebase/app";
// import { getFirestore, doc, getDoc, setDoc } from "firebase/firestore";
// const firebaseConfig = {...};
// const app = initializeApp(firebaseConfig);
// const db = getFirestore(app);

// --------------------
// Variables
// --------------------
let subscriberCount = 0;
let words = new Set(JSON.parse(localStorage.getItem("words")||"[]"));
const input = document.getElementById("wordInput");

// --------------------
// Fetch subscribers
// --------------------
async function fetchSubscribers(){
  try{
    const apiKey = "AIzaSyBtcKxmge24wcaEQwJv0uBHKmQBLgIg0gw";
    const channelId = "UCL6OtB3m-gQ2mgRg61-aDXw";
    const res = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${apiKey}`);
    const data = await res.json();
    if(data.items && data.items.length>0){
      subscriberCount = parseInt(data.items[0].statistics.subscriberCount);
      document.getElementById("subscriberCount").textContent = subscriberCount.toLocaleString();
      updateDisplay();
    }else{
      document.getElementById("subscriberCount").textContent="Subscriber data not found.";
    }
  }catch(e){
    document.getElementById("subscriberCount").textContent="Error loading subscribers.";
    console.error(e);
  }
}
fetchSubscribers();
setInterval(fetchSubscribers,30000);

// --------------------
// Word input
// --------------------
input.addEventListener("keydown", function(e){
  if(e.key==="Enter") addWord();
});

function addWord(){
  const newWord = input.value.trim().toLowerCase();
  document.getElementById("message").textContent="";
  if(!newWord) return;
  if(words.has(newWord)){
    document.getElementById("message").textContent="Duplicate!";
    return;
  }
  words.add(newWord);
  localStorage.setItem("words", JSON.stringify([...words]));
  updateDisplay();
  input.value="";
}

function updateDisplay(){
  const list = document.getElementById("wordList");
  list.innerHTML="";
  [...words].reverse().forEach(w=>{
    const li=document.createElement("li");
    li.textContent=w;
    list.appendChild(li);
  });
  document.getElementById("counter").textContent = `${words.size.toLocaleString()} / ${subscriberCount.toLocaleString()}`;

  // Update progress bar
  const percent = subscriberCount>0 ? Math.min(words.size/subscriberCount*100,100) : 0;
  const bar = document.getElementById("progressBar");
  bar.style.width=`${percent}%`;
  bar.textContent=`${percent.toFixed(2)}%`;
  updateTimerDisplay();
}

// --------------------
// Clear words button
// --------------------
document.getElementById("clearWordsBtn").addEventListener("click", ()=>{
  const pw = prompt("Enter password to clear all words:");
  if(pw==="anuspass"){
    words.clear();
    localStorage.removeItem("words");
    updateDisplay();
  }
});

// --------------------
// Timer & WPM
// --------------------
let timerInterval;
let elapsedSeconds = 0;

function formatTime(sec){
  const h=String(Math.floor(sec/3600)).padStart(2,'0');
  const m=String(Math.floor((sec%3600)/60)).padStart(2,'0');
  const s=String(sec%60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

function updateTimerDisplay(){
  document.getElementById("timerDisplay").textContent = formatTime(elapsedSeconds);
  const wpm = elapsedSeconds>0 ? (words.size/elapsedSeconds)*60 : 0;
  const remainingWords = Math.max(subscriberCount-words.size,0);
  const etaSeconds = wpm>0 ? remainingWords/wpm*60 : 0;
  document.getElementById("statsDisplay").textContent = `WPM: ${wpm.toFixed(2)} | ETA: ${formatTime(Math.ceil(etaSeconds))}`;
}

function startTimer(){
  if(!timerInterval){
    timerInterval = setInterval(()=>{
      elapsedSeconds++;
      updateTimerDisplay();
    },1000);
  }
}

function pauseTimer(){
  clearInterval(timerInterval);
  timerInterval=null;
}

function resetTimer(){
  pauseTimer();
  elapsedSeconds=0;
  updateTimerDisplay();
}

function stopTimer(){
  document.getElementById("timerWindow").style.display="none";
  pauseTimer();
}

updateDisplay();
updateTimerDisplay();
</script>
</body>
</html>
